<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Русско-Английский Словарь</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 50px;
        }

        input[type="text"],
        input[type="text"] {
            padding: 10px;
            margin: 5px;
        }

        select {
            padding: 10px;
            margin: 5px;
        }

        button {
            cursor: pointer;
            padding: 10px;
            margin: 5px;
        }

        table {
            width: 70%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .delete-button,
        .save-button,
        .edit-button,
        .new-word-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 2px;
            cursor: pointer;
        }

        .editing-row {
            background-color: yellow;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

    <h1>Русско-Английский Словарь</h1>

    <button id="newWordButton" class="new-word-button">Новое слово</button>

    <div id="wordForm" class="hidden">
        <label for="russianWord">Русское слово:</label>
        <input type="text" id="russianWord" placeholder="Введите русское слово">

        <label for="englishTranslation">Английский перевод:</label>
        <input type="text" id="englishTranslation" placeholder="Введите английский перевод">

        <label for="wordType">Тип слова:</label>
        <select id="wordType">
            <option value="существительное">Существительное</option>
            <option value="прилагательное">Прилагательное</option>
            <option value="глагол">Глагол</option>
        </select>

        <label for="comment">Комментарий:</label>
        <input type="text" id="comment" placeholder="Введите комментарий">

        <button id="addButton">+</button>
    </div>

    <button id="saveButton">Сохранить в JSON</button>
    <button id="loadButton">Загрузить из JSON</button>

    <label for="searchInput">Поиск:</label>
    <input type="text" id="searchInput" placeholder="Введите слово для поиска">

    <table id="dictionary">
        <tr>
            <th data-sort="russian">Русское слово</th>
            <th data-sort="english">Английский перевод</th>
            <th data-sort="type">Тип слова</th>
            <th data-sort="comment">Комментарий</th>
            <th>Действия</th>
        </tr>
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const dictionaryApp = {
                dictionary: [],

                init: function () {
                    this.setupEventListeners();
                    this.renderDictionary();
                },

                addWord: function () {
                    const russianWordInput = document.getElementById('russianWord');
                    const englishTranslationInput = document.getElementById('englishTranslation');
                    const wordTypeSelect = document.getElementById('wordType');
                    const commentInput = document.getElementById('comment');

                    const russianWord = this.formatWord(russianWordInput.value.trim());
                    const englishTranslation = this.formatWord(englishTranslationInput.value.trim());
                    const wordType = this.formatWord(wordTypeSelect.value);
                    const comment = commentInput.value.trim();

                    if (russianWord !== '' || englishTranslation !== '') {
                        this.dictionary.push({ russian: russianWord, english: englishTranslation, type: wordType, comment: comment });
                        this.sortDictionary('russian');
                        this.renderDictionary();
                        russianWordInput.value = '';
                        englishTranslationInput.value = '';
                        wordTypeSelect.value = 'существительное';
                        commentInput.value = '';
                    }
                },

                renderDictionary: function (filteredDictionary) {
                    const table = document.getElementById('dictionary');
                    table.innerHTML = '<tr><th data-sort="russian">Русское слово</th><th data-sort="english">Английский перевод</th><th data-sort="type">Тип слова</th><th data-sort="comment">Комментарий</th><th>Действия</th></tr>';

                    const displayDictionary = filteredDictionary || this.dictionary;

                    displayDictionary.forEach((entry, index) => {
                        const row = table.insertRow();
                        this.createTableCell(row, this.createInput('text', entry.russian, true));
                        this.createTableCell(row, this.createInput('text', entry.english, true));
                        this.createTableCell(row, this.createInput('text', entry.type, true));
                        this.createTableCell(row, this.createInput('text', entry.comment, true));

                        const cell5 = row.insertCell(4);
                        cell5.appendChild(this.createButton('✎', 'edit-button', () => this.enableEdit(index)));
                        cell5.appendChild(this.createButton('❌', 'delete-button', () => this.deleteWord(index)));
                    });
                },

                createInput: function (type, value, disabled) {
                    const input = document.createElement('input');
                    input.type = type;
                    input.value = value;
                    input.disabled = disabled;
                    return input;
                },

                createButton: function (text, className, clickHandler) {
                    const button = document.createElement('button');
                    button.innerText = text;
                    button.classList.add(className);
                    button.onclick = clickHandler;
                    return button;
                },

                createTableCell: function (row, element) {
                    const cell = row.insertCell();
                    cell.appendChild(element);
                },

                sortDictionary: function (field) {
                    this.dictionary.sort((a, b) => (a[field] > b[field]) ? 1 : -1);
                    this.renderDictionary();
                },

                searchWord: function () {
                    const searchInput = document.getElementById('searchInput');
                    const searchQuery = searchInput.value.trim().toLowerCase();

                    const filteredDictionary = this.dictionary.filter(entry =>
                        entry.russian.toLowerCase().includes(searchQuery) ||
                        entry.english.toLowerCase().includes(searchQuery) ||
                        entry.type.toLowerCase().includes(searchQuery) ||
                        entry.comment.toLowerCase().includes(searchQuery)
                    );

                    this.renderDictionary(filteredDictionary);
                },

                formatWord: function (word) {
                    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                },

                deleteWord: function (index) {
                    const confirmDelete = confirm('Вы уверены, что хотите удалить это слово?');

                    if (confirmDelete) {
                        this.dictionary.splice(index, 1);
                        this.renderDictionary();
                    }
                },

                enableEdit: function (index) {
                    const table = document.getElementById('dictionary');
                    const row = table.rows[index + 1];

                    row.classList.add('editing-row');

                    for (let i = 0; i < row.cells.length - 1; i++) {
                        const cell = row.cells[i];
                        const input = cell.firstChild;
                        input.disabled = false;
                    }

                    const editButton = row.cells[row.cells.length - 1].querySelector('.edit-button');
                    editButton.innerText = '✔';
                    editButton.classList.remove('edit-button');
                    editButton.classList.add('save-button');
                    editButton.onclick = () => this.saveEdit(index);
                },

                saveEdit: function (index) {
                    const table = document.getElementById('dictionary');
                    const row = table.rows[index + 1];

                    const russianInput = row.cells[0].firstChild;
                    const englishInput = row.cells[1].firstChild;
                    const typeInput = row.cells[2].firstChild;
                    const commentInput = row.cells[3].firstChild;

                    const editedRussian = this.formatWord(russianInput.value.trim());
                    const editedEnglish = this.formatWord(englishInput.value.trim());
                    const editedType = this.formatWord(typeInput.value.trim());
                    const editedComment = commentInput.value.trim();

                    this.dictionary[index] = { russian: editedRussian, english: editedEnglish, type: editedType, comment: editedComment };

                    this.renderDictionary();
                    row.classList.remove('editing-row');
                },

                saveDictionary: function () {
                    const jsonContent = JSON.stringify(this.dictionary, null, 2);
                    // Здесь отправляем данные на сервер, например, с помощью fetch или другого метода
                    fetch('save-dictionary.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: jsonContent
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Ошибка сохранения данных.');
                        }
                        alert('Данные сохранены успешно.');
                    })
                    .catch(error => {
                        console.error('Ошибка:', error);
                    });
                },

                loadDictionary: function () {
                    // Здесь отправляем запрос на сервер для получения данных
                    fetch('load-dictionary.php')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Ошибка загрузки данных.');
                        }
                        return response.json();
                    })
                    .then(data => {
                        this.dictionary = data;
                        this.renderDictionary();
                    })
                    .catch(error => {
                        console.error('Ошибка:', error);
                    });
                },

                handleFileSelect: function (event) {
                    const file = event.target.files[0];

                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const jsonData = JSON.parse(e.target.result);
                                if (Array.isArray(jsonData)) {
                                    this.dictionary = jsonData;
                                    this.renderDictionary();
                                } else {
                                    alert('Некорректный формат файла.');
                                }
                            } catch (error) {
                                alert('Ошибка при чтении файла.');
                            }
                        };
                        reader.readAsText(file);
                    }
                },

                setupEventListeners: function () {
                    document.getElementById('newWordButton').addEventListener('click', () => this.toggleWordForm());
                    document.getElementById('addButton').addEventListener('click', () => this.addWord());
                    document.getElementById('addButton').addEventListener('click', () => this.toggleWordForm());
                    document.getElementById('saveButton').addEventListener('click', () => this.saveDictionary());
                    document.getElementById('loadButton').addEventListener('click', () => this.loadDictionary());
                    document.getElementById('searchInput').addEventListener('input', () => this.searchWord());
                },

                toggleWordForm: function () {
                    const wordForm = document.getElementById('wordForm');
                    wordForm.classList.toggle('hidden');
                },
            };

            dictionaryApp.init();
        });
    </script>

</body>

</html>
